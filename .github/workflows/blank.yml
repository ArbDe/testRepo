name: "Delete old folders from S3"
on:
  push:
  workflow_dispatch:
  
permissions:
  id-token: write


jobs:
  remove:
    runs-on: ubuntu-latest

    steps:
    - name: Configure AWS credentials
      uses: aws-actions/configure-aws-credentials@v1
      with:
       aws-access-key-id: AKIARQARJQ6T3H3PV3EO
       aws-secret-access-key: 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
       aws-region: us-east-1

    - name: List S3 bucket folders
      run: |
            now=$(date +%s)
            cutOff=$(date -d '-30 minutes' +%s)
            echo $cutOff
            folders=$(aws s3 ls s3://beni-bucket1/testFolder/ --recursive | sort | awk '{print $1}')
            
            arr=()

            for val in "$@"; do
              arr+=("$val")
            done

            for folder in $folders; do
              if [[ " ${arr[@]} " =~ " ${folder} " ]]; then
                echo "$folder"
              fi
              arr+=("$folder")
            done
            
            echo "${arr[*]}"
            
            #for value in "${arr[@]}"; do
            # echo "$value" 
            #done

            













